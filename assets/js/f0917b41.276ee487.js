"use strict";(globalThis.webpackChunkphysical_ai_and_humanoid_robots=globalThis.webpackChunkphysical_ai_and_humanoid_robots||[]).push([[8881],{2476(n,e,o){o.r(e),o.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"module2/hands-on-joint-control","title":"Hands-on - Control a Simulated Joint via ROS 2 Nodes","description":"A hands-on exercise to create ROS 2 Python nodes using rclpy to publish commands and control a simulated robot joint.","source":"@site/docs/module2/04-hands-on-joint-control.md","sourceDirName":"module2","slug":"/module2/hands-on-joint-control","permalink":"/hackathon-humanoid-robotics-textbook/docs/module2/hands-on-joint-control","draft":false,"unlisted":false,"editUrl":"https://github.com/Umm-e-Hani02/hackathon-humanoid-robotics-textbook/tree/main/docs/module2/04-hands-on-joint-control.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Hands-on - Control a Simulated Joint via ROS 2 Nodes","description":"A hands-on exercise to create ROS 2 Python nodes using rclpy to publish commands and control a simulated robot joint.","keywords":["ROS 2","rclpy","Python","Hands-on","Robot Control","Simulated Joint","Publisher","Subscriber"]},"sidebar":"tutorialSidebar","previous":{"title":"URDF for Humanoids - Describing Robot Anatomy","permalink":"/hackathon-humanoid-robotics-textbook/docs/module2/urdf-for-humanoids"},"next":{"title":"Physics Simulation in Gazebo","permalink":"/hackathon-humanoid-robotics-textbook/docs/module3/gazebo-simulation"}}');var r=o(4848),i=o(8453);const t={sidebar_position:4,title:"Hands-on - Control a Simulated Joint via ROS 2 Nodes",description:"A hands-on exercise to create ROS 2 Python nodes using rclpy to publish commands and control a simulated robot joint.",keywords:["ROS 2","rclpy","Python","Hands-on","Robot Control","Simulated Joint","Publisher","Subscriber"]},l="Hands-on: Control a Simulated Joint via ROS 2 Nodes",c={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Goal",id:"goal",level:2},{value:"Setup",id:"setup",level:2},{value:"Running the Exercise",id:"running-the-exercise",level:2},{value:"Reflection",id:"reflection",level:2},{value:"Debugging Tips",id:"debugging-tips",level:2}];function d(n){const e={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"hands-on-control-a-simulated-joint-via-ros-2-nodes",children:"Hands-on: Control a Simulated Joint via ROS 2 Nodes"})}),"\n",(0,r.jsxs)(e.p,{children:["In this exercise, you will create a simple ROS 2 Python node that publishes commands to control a simulated robot joint. This builds upon your understanding of ROS 2 nodes, topics, and ",(0,r.jsx)(e.code,{children:"rclpy"}),"."]}),"\n",(0,r.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"A working ROS 2 environment (e.g., Foxy, Galactic, Humble, Iron)"}),"\n",(0,r.jsx)(e.li,{children:"Basic familiarity with Python and the command line"}),"\n",(0,r.jsx)(e.li,{children:"Understanding of ROS 2 concepts (Nodes, Topics) from previous lessons"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"goal",children:"Goal"}),"\n",(0,r.jsx)(e.p,{children:"To create a ROS 2 publisher node in Python that sends target joint positions to a simulated joint and observe the joint's movement."}),"\n",(0,r.jsx)(e.h2,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(e.p,{children:'For simplicity, we will simulate a joint in this exercise. In a full simulation (e.g., Gazebo), the joint controller would subscribe to a topic and move the actual joint. Here, we\'ll create a basic Python script that "receives" and "displays" the joint command.'}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Create a ROS 2 Package (if you haven't already)"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"cd ~/ros2_ws/src\r\nros2 pkg create --build-type ament_python my_robot_control\r\ncd my_robot_control\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsxs)(e.strong,{children:["Create the Joint Controller Subscriber (",(0,r.jsx)(e.code,{children:"joint_subscriber.py"}),")"]}),":\r\nThis script will act as our simulated joint. It will subscribe to a topic and print the received joint command."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# ~/ros2_ws/src/my_robot_control/my_robot_control/joint_subscriber.py\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Float64 # For joint position commands\r\n\r\nclass JointSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('joint_subscriber_node')\r\n        self.subscription = self.create_subscription(\r\n            Float64,\r\n            '/joint_commands', # Topic for joint commands\r\n            self.joint_command_callback,\r\n            10)\r\n        self.get_logger().info('Joint Subscriber Node started. Waiting for commands...')\r\n\r\n    def joint_command_callback(self, msg):\r\n        self.get_logger().info(f'Received joint command: {msg.data:.2f} radians')\r\n        # In a real robot, this value would be sent to a motor controller\r\n        # For this exercise, we just print it to simulate the effect.\r\n        print(f\"--- SIMULATED JOINT MOVEMENT ---\")\r\n        print(f\"Joint moving to position: {msg.data:.2f} radians\")\r\n        print(f\"----------------------------------\")\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    joint_subscriber = JointSubscriber()\r\n    rclpy.spin(joint_subscriber)\r\n    joint_subscriber.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsxs)(e.strong,{children:["Create the Joint Publisher (",(0,r.jsx)(e.code,{children:"joint_publisher.py"}),")"]}),":\r\nThis script will publish a sequence of joint positions to control our simulated joint."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# ~/ros2_ws/src/my_robot_control/my_robot_control/joint_publisher.py\r\n\r\n    import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Float64\r\nimport time\r\n\r\nclass JointPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('joint_publisher_node')\r\n        self.publisher_ = self.create_publisher(Float64, '/joint_commands', 10)\r\n        self.joint_positions = [0.0, 0.5, -0.5, 0.0, 1.0, -1.0, 0.0] # Radians\r\n        self.current_position_index = 0\r\n        self.timer = self.create_timer(2.0, self.timer_callback) # Publish every 2 seconds\r\n        self.get_logger().info('Joint Publisher Node started.')\r\n\r\n    def timer_callback(self):\r\n        if self.current_position_index < len(self.joint_positions):\r\n            msg = Float64()\r\n            msg.data = self.joint_positions[self.current_position_index]\r\n            self.publisher_.publish(msg)\r\n            self.get_logger().info(f'Publishing joint command: {msg.data:.2f} radians')\r\n            self.current_position_index += 1\r\n        else:\r\n            self.get_logger().info('Finished publishing all joint commands. Shutting down.')\r\n            self.destroy_node()\r\n            rclpy.shutdown()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    joint_publisher = JointPublisher()\r\n    rclpy.spin(joint_publisher)\r\n    # Note: rclpy.spin() will block until the node is destroyed or ROS 2 is shut down.\r\n    # The timer_callback handles the shutdown in this example.\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsxs)(e.strong,{children:["Update ",(0,r.jsx)(e.code,{children:"setup.py"})]}),":\r\nAdd the new Python executables to your ",(0,r.jsx)(e.code,{children:"my_robot_control"})," package's ",(0,r.jsx)(e.code,{children:"setup.py"}),"."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# ~/ros2_ws/src/my_robot_control/setup.py\r\n\r\nfrom setuptools import find_packages, setup\r\n\r\npackage_name = 'my_robot_control'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=find_packages(exclude=['test']),\r\n    data_files=[\r\n        ('share/' + package_name, ['package.xml']),\r\n        ('share/' + package_name + '/resource', ['resource/' + package_name]),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='your_name',\r\n    maintainer_email='your_email@example.com',\r\n    description='ROS 2 package for controlling a simulated robot joint.',\r\n    license='Apache License 2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'joint_publisher = my_robot_control.joint_publisher:main',\r\n            'joint_subscriber = my_robot_control.joint_subscriber:main',\r\n        ],\r\n    },\r\n)\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Build Your Package"}),":\r\nFrom your ROS 2 workspace root (",(0,r.jsx)(e.code,{children:"~/ros2_ws"}),"), build the package:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"colcon build --packages-select my_robot_control\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Source Your Workspace"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"running-the-exercise",children:"Running the Exercise"}),"\n",(0,r.jsxs)(e.p,{children:["Open two separate terminal windows, navigate to your ROS 2 workspace (",(0,r.jsx)(e.code,{children:"~/ros2_ws"}),"), and source it in both."]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Terminal 1: Start the Joint Subscriber (Simulated Joint)"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ros2 run my_robot_control joint_subscriber\n"})}),"\n",(0,r.jsx)(e.p,{children:"This terminal will show messages as the joint receives commands."}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Terminal 2: Start the Joint Publisher (Controller)"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ros2 run my_robot_control joint_publisher\n"})}),"\n",(0,r.jsxs)(e.p,{children:["This terminal will send a sequence of joint position commands. Observe how the ",(0,r.jsx)(e.code,{children:"joint_subscriber"})," in Terminal 1 reacts."]}),"\n",(0,r.jsx)(e.h2,{id:"reflection",children:"Reflection"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"How does the publisher-subscriber model facilitate modular control?"}),"\n",(0,r.jsx)(e.li,{children:"What would be the next steps to integrate this into a full robot simulation (e.g., Gazebo)?"}),"\n",(0,r.jsx)(e.li,{children:"How would you add error handling or feedback mechanisms (e.g., current joint position) to this system?"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"This exercise provides a foundational understanding of how ROS 2 nodes can be used to command and monitor robot joints, a critical step towards controlling complex humanoid movements."}),"\n",(0,r.jsx)(e.h2,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsxs)(e.strong,{children:[(0,r.jsx)(e.code,{children:"colcon build"})," Issues"]}),": If ",(0,r.jsx)(e.code,{children:"colcon build"})," fails, check the error messages carefully. Common issues include Python syntax errors, missing dependencies in ",(0,r.jsx)(e.code,{children:"package.xml"})," or ",(0,r.jsx)(e.code,{children:"setup.py"}),", or incorrect ",(0,r.jsx)(e.code,{children:"entry_points"})," in ",(0,r.jsx)(e.code,{children:"setup.py"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Node Not Found"}),": If ",(0,r.jsx)(e.code,{children:"ros2 run"}),' fails with "package not found" or "executable not found", ensure:',"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["You have built your workspace (",(0,r.jsx)(e.code,{children:"colcon build"}),")."]}),"\n",(0,r.jsxs)(e.li,{children:["You have sourced your workspace (",(0,r.jsx)(e.code,{children:"source install/setup.bash"}),")."]}),"\n",(0,r.jsxs)(e.li,{children:["The ",(0,r.jsx)(e.code,{children:"entry_points"})," in ",(0,r.jsx)(e.code,{children:"setup.py"})," are correct and match your Python script names."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"No Messages Received"}),": If the subscriber isn't receiving messages:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Topic Name Mismatch"}),": Double-check that the publisher and subscriber are using the ",(0,r.jsx)(e.em,{children:"exact same topic name"})," (",(0,r.jsx)(e.code,{children:"/joint_commands"})," in this case)."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"QoS Profile Mismatch"}),": While ",(0,r.jsx)(e.code,{children:"10"})," is a common default, ensure the QoS profiles (",(0,r.jsx)(e.code,{children:"depth"})," parameter in ",(0,r.jsx)(e.code,{children:"create_publisher"})," and ",(0,r.jsx)(e.code,{children:"create_subscription"}),") are compatible."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Publisher Not Running"}),": Ensure the publisher node is running in its own terminal."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"ROS 2 Daemon"}),": Sometimes restarting the ROS 2 daemon can help if communication issues persist: ",(0,r.jsx)(e.code,{children:"ros2 daemon stop"})," then ",(0,r.jsx)(e.code,{children:"ros2 daemon start"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Python Errors in Node"}),": If a node crashes, the terminal running that node will usually show a Python traceback. Read it from the bottom up to pinpoint the error."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:'"Shutting down" message from publisher'}),": The publisher in this example is designed to shut down after publishing all its commands. If you want it to publish indefinitely, remove the ",(0,r.jsx)(e.code,{children:"if self.current_position_index < len(self.joint_positions):"})," block and the ",(0,r.jsx)(e.code,{children:"self.destroy_node()"})," and ",(0,r.jsx)(e.code,{children:"rclpy.shutdown()"})," calls from the ",(0,r.jsx)(e.code,{children:"else"})," block."]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453(n,e,o){o.d(e,{R:()=>t,x:()=>l});var s=o(6540);const r={},i=s.createContext(r);function t(n){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);