# Data Model: RAG Chatbot Frontend Integration

## Entities

### UserQuery

Represents a single natural language text input provided by the user to the chatbot.

-   **Fields**:
    -   `id` (UUID): Unique identifier for the user query.
    -   `text` (String): The actual query text from the user.
    -   `timestamp` (DateTime): The time when the query was submitted.

### ChatbotResponse

Represents a single natural language text response generated by the RAG backend, grounded in the book content, in response to a user query.

-   **Fields**:
    -   `id` (UUID): Unique identifier for the chatbot response.
    -   `query_id` (UUID): Foreign key referencing the `UserQuery` it responds to.
    -   `text` (String): The response text from the chatbot.
    -   `timestamp` (DateTime): The time when the response was received.
    -   `is_grounded` (Boolean): Indicates if the response is grounded in the book content (inferred from backend response).
    -   `error_message` (String, Optional): If the response is an error or "no answer" message, this field will contain the details.

### Conversation

Represents a sequence of interactions between a user and the chatbot. This would be stored client-side for the current session.

-   **Fields**:
    -   `id` (UUID): Unique identifier for the conversation session.
    -   `messages` (Array of `UserQuery` | `ChatbotResponse`): An ordered list of all queries and responses within this conversation.
    -   `start_time` (DateTime): The time when the conversation started.
    -   `last_updated` (DateTime): The time of the most recent interaction.

## Relationships

-   A `Conversation` contains multiple `UserQuery` and `ChatbotResponse` entries.
-   Each `ChatbotResponse` is directly linked to a `UserQuery`.

## Validation Rules (Frontend)

-   `UserQuery.text`: Must not be empty. Maximum length TBD.
-   `ChatbotResponse.text`: Must not be empty if `error_message` is null.
-   `Conversation.messages`: Max number of messages TBD to prevent excessive client-side storage.

## State Transitions (Frontend)

-   **Initial State**: Chatbot widget closed, no active conversation.
-   **Open Chatbot**: Widget opens, a new `Conversation` may be initiated or a previous one resumed.
-   **Send Query**: User input is sent. UI displays loading indicator.
-   **Receive Response**: UI displays chatbot response or error message. Loading indicator is hidden.
-   **Close Chatbot**: Widget closes. Conversation state is persisted (e.g., in local storage) or cleared based on UX design.